plugins {
    id 'java'
    id 'org.jetbrains.intellij' version '0.4.9'
}
ext {
  jxBrowserVersion = '7.0'
  if (project.hasProperty("mac")) {
    arch = 'mac'
  } else if (project.hasProperty("win32")) {
    arch = 'win32'
  } else if (project.hasProperty("win64")) {
    arch = 'win64'
  } else if (project.hasProperty("linux64")) {
    arch = 'linux64'
  } else {
    arch = 'cross-platform'
  }
}

group 'com.tmobile'
version '1.0-SNAPSHOT'

apply plugin: 'java'
apply plugin: 'org.jetbrains.intellij'

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
  mavenCentral()
  maven { url = 'https://maven.teamdev.com/repository/products' }
}

dependencies {
  compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.9.9'
  compile "com.teamdev.jxbrowser:jxbrowser-swing:${jxBrowserVersion}"
  compile "com.teamdev.jxbrowser:jxbrowser-${arch}:${jxBrowserVersion}"
}

intellij {
  version 'IC-2017.2'
  pluginName "PercyEditor-${arch}"
  updateSinceUntilBuild false
  downloadSources true
}
patchPluginXml {
  // pluginDescription "Percy Editor for ${arch}"
  // changeNotes """
  //     First Release"""
}

task generateSources(type: Copy) {
    from 'build/patchedPluginXmlFiles'
    into "build/resources/main/META-INF"
    filter { line -> line.replaceAll('<name>PercyEditor</name>', "<name>PercyEditor-${arch}</name>").replaceAll('<id>com.tmobile.percy</id>', "<id>com.tmobile.percy.${arch}</id>") }
}
jar {
    dependsOn generateSources
}

